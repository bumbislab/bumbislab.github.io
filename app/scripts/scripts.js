"use strict";angular.module("config",[]).constant("ENV",{name:"production",apiEndpoint:"http://api.yoursite.com/"});var app=angular.module("bumbislabApp",["ionic","config","lbServices"]);app.run(["$ionicPlatform",function(a){console.log("bumbislabApp.run() called"),a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}]),app.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){a.state("login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginCtrl"}).state("main",{url:"","abstract":!0,templateUrl:"templates/main.html",controller:"MainCtrl"}).state("main.home",{url:"/home",views:{mainContent:{templateUrl:"templates/home.html",controller:"HomeCtrl"}}}).state("main.credits",{url:"/credits",views:{mainContent:{templateUrl:"templates/credits.html",controller:"CreditsCtrl"}}}).state("main.support",{url:"/support",views:{mainContent:{templateUrl:"templates/support.html",controller:"SupportCtrl"}}}),b.otherwise("/home"),c.interceptors.push("AuthInterceptor")}]),app.factory("AuthInterceptor",["$q","$location",function(a,b){return{responseError:function(c){return console.log("intercepted rejection of ",c.config.url,c.status),401==c.status&&b.path("/login"),a.reject(c)}}}]);var app=angular.module("bumbislabApp");app.controller("MainCtrl",["$scope","LoopBackAuth",function(){console.log("bumbislabApp:MainCtrl")}]);var app=angular.module("bumbislabApp");app.controller("HomeCtrl",["$scope",function(a){a.aaa="aaa"}]);var app=angular.module("bumbislabApp");app.controller("MenuCtrl",["$scope",function(a){a.menuItems=[{title:"Home",icon:"ion-home",href:"#/home"},{title:"Support",icon:"ion-help",href:"#/support"},{title:"Credits",icon:"ion-wrench",href:"#/credits"},{title:"Login",icon:"ion-log-in",href:"#/login"},{title:"Logout",icon:"ion-log-out",href:"#"}]}]);var app=angular.module("bumbislabApp");app.controller("CreditsCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);var app=angular.module("bumbislabApp");app.controller("SupportCtrl",["$scope","Item",function(a,b){a.items=b.query(),a.doRefresh=function(){a.items=b.query(function(){a.$broadcast("scroll.refreshComplete")})}}]);var app=angular.module("bumbislabApp");app.controller("LoginCtrl",["$scope","$location","User","LoopBackAuth",function(a,b,c,d){console.log(d.accessTokenId),a.loginResults="",a.credentials={email:"",password:""},a.login=function(){console.log("Login button clicked"),a.loginResults=c.login({include:"user",rememberMe:!0},a.credentials,function(){console.log(a.loginResults),d.setUser(a.loginResults.id,a.loginResults.userId,a.loginResults.user),d.rememberMe=!0,d.save(),console.log(d.accessTokenId),b.path("#/home")},function(b){console.log(b.data.error),a.loginError=b.data.error})}}]),function(a,b,c){var d="http://safe-sands-8713.herokuapp.com/api",e=b.module("lbServices",["ngResource"]);e.factory("User",["LoopBackResource","LoopBackAuth","$injector",function(a){var b=a(d+"/Users/:id",{id:"@id"},{login:{url:d+"/Users/login",method:"POST"},logout:{url:d+"/Users/logout",method:"POST"},confirm:{url:d+"/Users/confirm",method:"GET"},resetPassword:{url:d+"/Users/reset",method:"POST"},prototype$__findById__accessTokens:{url:d+"/Users/:id/accessTokens/:fk",method:"GET"},prototype$__destroyById__accessTokens:{url:d+"/Users/:id/accessTokens/:fk",method:"DELETE"},prototype$__updateById__accessTokens:{url:d+"/Users/:id/accessTokens/:fk",method:"PUT"},prototype$__get__accessTokens:{url:d+"/Users/:id/accessTokens",method:"GET",isArray:!0},prototype$__create__accessTokens:{url:d+"/Users/:id/accessTokens",method:"POST"},prototype$__delete__accessTokens:{url:d+"/Users/:id/accessTokens",method:"DELETE"},create:{url:d+"/Users",method:"POST"},upsert:{url:d+"/Users",method:"PUT"},exists:{url:d+"/Users/:id/exists",method:"GET"},findById:{url:d+"/Users/:id",method:"GET"},find:{url:d+"/Users",method:"GET",isArray:!0},findOne:{url:d+"/Users/findOne",method:"GET"},updateAll:{url:d+"/Users/update",method:"POST"},deleteById:{url:d+"/Users/:id",method:"DELETE"},count:{url:d+"/Users/count",method:"GET"},prototype$updateAttributes:{url:d+"/Users/:id",method:"PUT"}});return b}]),e.factory("Item",["LoopBackResource","LoopBackAuth","$injector",function(a){var b=a(d+"/items/:id",{id:"@id"},{create:{url:d+"/items",method:"POST"},upsert:{url:d+"/items",method:"PUT"},exists:{url:d+"/items/:id/exists",method:"GET"},findById:{url:d+"/items/:id",method:"GET"},find:{url:d+"/items",method:"GET",isArray:!0},findOne:{url:d+"/items/findOne",method:"GET"},updateAll:{url:d+"/items/update",method:"POST"},deleteById:{url:d+"/items/:id",method:"DELETE"},count:{url:d+"/items/count",method:"GET"},prototype$updateAttributes:{url:d+"/items/:id",method:"PUT"}});return b}]),e.factory("LoopBackAuth",function(){function a(){var a=this;e.forEach(function(b){a[b]=d(b)}),this.rememberMe=c,this.currentUserData=null}function b(a,b,c){var d="$LoopBack$"+b;null==c&&(c=""),a[d]=c}function d(a){var b="$LoopBack$"+a;return localStorage[b]||sessionStorage[b]||null}var e=["accessTokenId","currentUserId"];return a.prototype.save=function(){var a=this,c=this.rememberMe?localStorage:sessionStorage;e.forEach(function(d){b(c,d,a[d])})},a.prototype.setUser=function(a,b,c){this.accessTokenId=a,this.currentUserId=b,this.currentUserData=c},a.prototype.clearUser=function(){this.accessTokenId=null,this.currentUserId=null,this.currentUserData=null},new a}).config(["$httpProvider",function(a){a.interceptors.push("LoopBackAuthRequestInterceptor")}]).factory("LoopBackAuthRequestInterceptor",["$q","LoopBackAuth",function(a,b){return{request:function(d){if(b.accessTokenId)d.headers.authorization=b.accessTokenId;else if(d.__isGetCurrentUser__){var e={body:{error:{status:401}},status:401,config:d,headers:function(){return c}};return a.reject(e)}return d||a.when(d)}}}]).factory("LoopBackResource",["$resource",function(a){return function(b,c,d){var e=a(b,c,d);return e.prototype.$save=function(a,b){var c=e.upsert.call(this,{},this,a,b);return c.$promise||c},e}}])}(window,window.angular);